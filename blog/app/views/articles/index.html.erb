<h1>Listing articles</h1>

<% begin %>
<% if current_user.name != "" %>
<%=link_to 'New article', new_article_path %>
<% end %>
<% rescue %>
<% end %>


<p>Sort by:
<%= link_to "Newest", articles_path(order: 'created_at DESC') %>
<%= link_to "Oldest", articles_path(order: 'created_at ASC') %>
<%= link_to "Title", articles_path(order: 'title') %>
</p>

<table>
  <% @articles.each do |article| %>
    <tr>
      <td>
        Posted by:
        <% if article.user %>
            <!--display authors name if there is one-->
            <%= article.user.name %>
            <% else %>
            [deleted]
          <% end %>
           at 
           <!--Timestamp for the creation of the article-->
      <%= article.created_at.change(offset: "+04:00").to_s(:db)%>
      <%= ", " %> <%= article.likes.count %> <%= (article.likes.count) == 1 ? 'Like' : 'Likes'%>
      <%= ", " %> <%= article.dislikes.count %> <%= (article.dislikes.count) == 1 ? 'Dislike' : 'Dislikes'%>
      
      
          <br><br>
          <h3>
      <%= article.title %>
      </h3>
      <br><br>
      
      <td><%= link_to 'Show', article_path(article) %></td>
      <% begin %>
      <% if current_user == article.user || current_user.name == "Admin" %>
      <td><%= link_to 'Edit', edit_article_path(article) %></td>
      <td><%= link_to 'Destroy', 
                                article_path(article),
                                method: :delete,
                                data: { confirm: 'Are you sure?' } %></td>
      <% end %>
      <% rescue %>
      <% end %>
    </tr>
  <% end %>
</table>